{"version":3,"sources":["webpack:///./main.js"],"names":["getUserMedia","require","Peer","kvServer","roomName","getParameterByName","console","log","myId","otherId","peer","myRole","otherRole","name","url","window","location","href","replace","regex","RegExp","results","exec","decodeURIComponent","setup","isInitiator","video","audio","err","stream","error","initiator","trickle","on","data","$","ajax","method","key","val","JSON","stringify","document","getElementById","addEventListener","signal","success","yourMessage","value","send","textContent","createElement","body","appendChild","src","URL","createObjectURL","play","getOtherId","fail","done","e","type"],"mappings":"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","file":"main.js","sourcesContent":["const getUserMedia = require('getusermedia');\nconst Peer = require('simple-peer');\n\nlet kvServer = 'https://gr.itguy.ir:9443';\nlet roomName = getParameterByName('r');\nconsole.log('welcome to room' , roomName);\nlet myId,otherId,peer,myRole,otherRole;\n\nfunction getParameterByName(name, url) {\n    if (!url) {\n      url = window.location.href;\n    }\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction setup(isInitiator){\n  myRole = isInitiator ? 'a' : 'b';\n  otherRole = isInitiator ? 'b' : 'a';\n  getUserMedia({ video: false, audio: true }, function (err, stream) {\n    if (err) return console.error(err);\n    peer = new Peer({\n      initiator: isInitiator,\n      trickle: false,\n      stream: stream\n    });\n    peer.on('signal', function (data) {\n      $.ajax({\n        url: kvServer + '/kv/v1/keys',\n        method: 'POST',\n        data: {\n          key: roomName + '-' + myRole ,\n          val: JSON.stringify(data)\n        }\n      })\n      // document.getElementById('yourId').value = JSON.stringify(data)\n    })\n\n    document.getElementById('connect').addEventListener('click', function () {\n        console.log('going to connect to role',otherRole);\n      if(otherId){ \n        console.log('signaling role',otherRole);\n        peer.signal(otherId);\n      }else{\n        console.log('we dont have otherId so going to call');\n        $.ajax({ // there is no otherID \n          url: kvServer + `/kv/v1/keys/${roomName}-${otherRole}`,\n          method: 'GET',\n          success: function(data){\n            console.log('signaling role',otherRole);\n            peer.signal(data);\n          },\n          error: err =>{\n            console.log('failed to get roleID ',otherRole);\n          }\n        })\n      }\n      \n    })\n\n    document.getElementById('send').addEventListener('click', function () {\n      let yourMessage = document.getElementById('yourMessage').value;\n      peer.send(yourMessage);\n    })\n\n    peer.on('data', function (data) {\n      document.getElementById('messages').textContent += data + '\\n';\n    })\n\n    peer.on('stream', function (stream) {\n      let video = document.createElement('video');\n      document.body.appendChild(video)\n\n      video.src = window.URL.createObjectURL(stream)\n      video.play()\n    })\n  })\n}\n\n\nlet getOtherId = $.ajax({\n  url: kvServer + `/kv/v1/keys/${roomName}-a`,\n  method: 'GET'\n})\ngetOtherId.fail(err => {\n  // you are the first one. initiate!\n  console.log('other side is not setup yet');\n  setup(true);\n});\ngetOtherId.done(data => {\n  // someone else is already here. ( or didn't cleanup after leaving )\n  console.log('otherId is ',data);\n  otherId = data;\n  setup(false);\n})\n\n$('button#reset').on('click', e => {\n  $.ajax({\n    url: kvServer + `/kv/v1/keys/${roomName}-${myRole}`,\n    type: 'DELETE'\n  })\n  $.ajax({\n    url: kvServer + `/kv/v1/keys/${roomName}-${otherRole}`,\n    type: 'DELETE'\n  })\n})\n\n\n// WEBPACK FOOTER //\n// ./main.js"],"sourceRoot":""}